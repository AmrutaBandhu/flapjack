sudo: false
language: ruby
rvm:
- '2.0'
- '2.1'
- '2.2'
env:
- GOPATH=$TRAVIS_BUILD_DIR
cache: bundler
services:
- redis-server
before_script:
- mkdir -p ./log
before_install:
- git submodule update --init --recursive
- gem --version
- wget http://s3.amazonaws.com/influxdb/influxdb_0.8.8_amd64.deb
- sudo dpkg -i influxdb_0.8.8_amd64.deb
- sudo /etc/init.d/influxdb start
- sleep 8
- 'curl -X POST ''http://localhost:8086/db?u=root&p=root'' -d ''{"name": "flapjack_test"}'''
- 'curl -X POST ''http://localhost:8086/db/flapjack_test/users?u=root&p=root'' -d ''{"name": "flapjack", "password": "flapjack"}'''
- 'curl -X POST ''http://localhost:8086/db/flapjack_test/users/zermelo?u=root&p=root'' -d ''{"admin": true}'''
install:
  - go get github.com/garyburd/redigo/redis
  - go get github.com/go-martini/martini
  - go get gopkg.in/alecthomas/kingpin.v1
  - go get github.com/oguzbilgic/pandik
  - bundle install
script: "bundle exec rspec spec && bundle exec rake pact:verify && bundle exec cucumber features && cd src/flapjack && go test -v"
notifications:
  # irc:
  #   channels:
  #     - 'irc.freenode.net#flapjack'
  #   template:
  #     - '%{message} %{repository}#%{build_number} (%{branch} - %{commit} : %{author})'
  hipchat:
    template:
      - '%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{message}
        (<a href="%{build_url}">Details</a>/<a href="%{compare_url}">Change view</a>)'
    format: html
    rooms:
      secure: ajMolTKDuprYJ9Fadcjb3evh80MyJSgjW4hl4OWnEHyrjQLnsO0hbAvSrKRFUzorMoi58L8XZXd01gMgRqRxMvwqfoHLv4njw8px4X9+F/hySPZj3aMAFM1HuoTmHqeP+Rl+1Ssg+Kss6N4JkgNS81s+tkRnnoHG1n/EhfH6PkE=
